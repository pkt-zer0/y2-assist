<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <title>Y2 assistant</title>
    <!--suppress CssUnusedSymbol -->
    <style>
        html {
            font-size: 4vw;
            user-select: none;
        }
        html, body {
            padding: 0;
            margin: 0;
            height: 100%;
            overflow: hidden;
        }
        #main {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        * {
            box-sizing: border-box;
            touch-action: manipulation;
        }
        .controls, .toggles {
            display: flex;
            width: 100%;
            height: 3rem;
            justify-content: space-between;
        }
        .toggles {
            height: 2rem;
        }
        button {
            background: #f0f0f0;
            color: black;

            font-size: 1rem;
            flex-basis: 0;
            flex-grow: 1;
            margin: 0 0.5rem;
            border-width: 0.0625rem;
        }
        button.large {
            flex-grow: 2;
        }
        button.on {
            background: #333;
            color: white;
        }
        .move {
            position: relative;
            width: 75vw;
            aspect-ratio: 1;
            font-size: 3rem;
            margin: auto;
        }
        .damage, .blockDamage, .speed, .adjust, .flags, .height, .level {
            display: flex;
            position: absolute;
            align-items: center;
            justify-content: center;
        }
        .description {
            position: absolute;
            left: 5%;
            font-size: 0.8em;
        }
        .damage {
            width: 50%;
            height: 50%;
            left: 20%;
            top: 20%;
            color: white;
            border-radius: 50%;
            overflow: hidden;
        }
        .damage.block {
            border-radius: 10% 10% 50% 50%;
        }
        .damage.projectile {
            border-radius: 20% 50% 50% 20%;
        }
        .blockDamage {
            background: lightblue;
            width : 20%;
            height: 20%;
            left  : 58%;
            top   : 58%;
            text-align: center;
            border-radius: 10% 10% 50% 50%;
        }
        .blockGap {
            position: absolute;
            background: gray;
            width: 100%;
            height: 50%;
        }
        .speed {
            background: palegoldenrod;
            color: grey;
            border-color: black;
            border-width: 0.0625rem;
            border-style: solid;
            top: 10%;
            left: 60%;
            width: 20%;
            height: 20%;
            border-radius: 50%;
        }
        .adjust {
            background: sandybrown;
            width : 20%;
            height: 30%;
            left  : 80%;
            top   : 30%;
        }
        .level {
            width: 20%;
            height: 20%;
            top: 50%;
            left: 20%;
            border-radius: 25%;
            font-size: 0.80em;
            color: black;
        }
        .flags {
            top: 80%;
            width: 90%;
            font-size: 0.8em;
            text-align: center;
        }
        .height {
            background: #800;
            width: 10%;
            height: 10%;
            left: 10%;
            border-radius: 50%;
        }
    </style>
    
</head>
<body>
<div id="main"></div>

        <script type="application/javascript">
            (function () {
  'use strict';

  var MoveType;
  (function (MoveType) {
      MoveType[MoveType["Dodge"] = 0] = "Dodge";
      MoveType[MoveType["Throw"] = 1] = "Throw";
      // Attacks
      MoveType[MoveType["Strike"] = 2] = "Strike";
      MoveType[MoveType["Projectile"] = 3] = "Projectile";
      // Blocks
      MoveType[MoveType["BlockLow"] = 4] = "BlockLow";
      MoveType[MoveType["BlockHigh"] = 5] = "BlockHigh";
  })(MoveType || (MoveType = {}));
  var StrikeHeight;
  (function (StrikeHeight) {
      StrikeHeight[StrikeHeight["Low"] = 0] = "Low";
      StrikeHeight[StrikeHeight["Mid"] = 1] = "Mid";
      StrikeHeight[StrikeHeight["High"] = 2] = "High";
  })(StrikeHeight || (StrikeHeight = {}));
  /* Move description shorthand (case sensitive):
    - A..J : normals
    - t, l, h, b, d: throw, low/high/full block, dodge
    - 1, 2 : super 1/2
    - !, ? : ability, gem ability
    - S, U : gem special, burst
  */

  //-- Move creation helpers --
  const MOVE_DEFAULTS = {
      damage: 0,
      speed: 0,
      level: 0,
      blockDamage: 0,
      height: StrikeHeight.Mid,
  };
  function mStrike(damage, speed, overrides = {}) {
      return {
          ...MOVE_DEFAULTS,
          type: MoveType.Strike,
          damage,
          speed,
          ...overrides,
      };
  }
  function mThrow(damage, speed, overrides = {}) {
      return {
          ...MOVE_DEFAULTS,
          type: MoveType.Throw,
          damage,
          speed,
          knockdown: true,
          ...overrides,
      };
  }
  function mProjectile(damage, speed, overrides = {}) {
      return {
          ...MOVE_DEFAULTS,
          type: MoveType.Projectile,
          damage,
          speed,
          level: 1,
          recur: true,
          lockdown: true,
          ...overrides,
      };
  }
  function mDodge(overrides = {}) {
      return {
          ...MOVE_DEFAULTS,
          type: MoveType.Dodge,
          ...overrides,
      };
  }

  const CHOICE_DEFAULTS = {
      description: '',
      firstDamage: 0,
      adjust: 0,
  };
  const BLOCK_LOW = {
      ...MOVE_DEFAULTS,
      ...CHOICE_DEFAULTS,
      type: MoveType.BlockLow,
      drawOnBlock: true,
      recur: true,
  };
  const BLOCK_HIGH = {
      ...MOVE_DEFAULTS,
      ...CHOICE_DEFAULTS,
      type: MoveType.BlockHigh,
      drawOnBlock: true,
      recur: true,
  };
  function cThrow(damage, speed, overrides = {}) {
      return {
          ...mThrow(damage, speed),
          ...CHOICE_DEFAULTS,
          description: 't',
          ...overrides,
      };
  }
  function cStrike(damage, speed, overrides = {}) {
      return {
          ...mStrike(damage, speed),
          ...CHOICE_DEFAULTS,
          ...overrides,
      };
  }
  function cProjectile(damage, speed, overrides = {}) {
      return {
          ...mProjectile(damage, speed),
          ...CHOICE_DEFAULTS,
          ...overrides,
      };
  }
  function cDodge(damage, overrides = {}) {
      return {
          ...mDodge(),
          ...CHOICE_DEFAULTS,
          damage,
          description: 'd',
          ...overrides,
      };
  }

  function applyOverride(base, override) {
      const choices = override.choices.map((c, i) => {
          return c ?? base.choices[i];
      });
      return {
          choices,
          hitback: override.hitback ?? base.hitback
      };
  }
  const bot1 = {
      normal: [
          { minHand: 5, maxHand: 6, choices: [
                  BLOCK_LOW,
                  BLOCK_HIGH,
                  BLOCK_LOW,
                  cThrow(7, 5),
                  cStrike(11, 7, { description: 'B → Z', adjust: -1, firstDamage: 4, height: StrikeHeight.Low }),
                  cStrike(12, 7, { description: 'Z → C', adjust: -1, blockDamage: 1, firstDamage: 7, height: StrikeHeight.High }),
                  cProjectile(8, 7, { description: 'X', blockDamage: 4 }),
                  cProjectile(8, 7, { description: 'X', blockDamage: 4 }),
              ], hitback: cThrow(7, 0, { adjust: -1 })
          },
          { minHand: 7, maxHand: 8, choices: [
                  BLOCK_LOW,
                  BLOCK_HIGH,
                  BLOCK_LOW,
                  cThrow(7, 5),
                  cStrike(12, 8, { description: 'A → BC', adjust: -2, firstDamage: 3, height: StrikeHeight.Low }),
                  cStrike(10, 11, { description: 'Y', blockDamage: 2, unsafe: true }),
                  cProjectile(8, 7, { description: 'X', blockDamage: 4 }),
                  cProjectile(8, 7, { description: 'X', blockDamage: 4 }),
              ], hitback: cStrike(10, 0, { adjust: -1 })
          },
          { minHand: 9, maxHand: 10, choices: [
                  BLOCK_LOW,
                  BLOCK_HIGH,
                  BLOCK_LOW,
                  cThrow(18, 5, { description: 't → CD', adjust: -2, firstDamage: 7, knockdown: false }),
                  cThrow(18, 5, { description: 't → CD', adjust: -2, firstDamage: 7, knockdown: false }),
                  cStrike(20, 8, { description: 'A → BCX', adjust: -3, firstDamage: 3, height: StrikeHeight.Low }),
                  cStrike(20, 8, { description: 'A → BCX', adjust: -3, firstDamage: 3, height: StrikeHeight.Low }),
                  cDodge(7, { description: 'd → t', adjust: -1, knockdown: true }),
              ], hitback: cStrike(10, 0, { adjust: -1 })
          },
          { minHand: 11, maxHand: 12, choices: [
                  cDodge(30, { description: '2', adjust: -2, always: true, super: true }),
                  cDodge(7, { description: 'd → t', adjust: -1, knockdown: true }),
                  cThrow(20, 5, { description: 't → DE', adjust: -2, firstDamage: 7, knockdown: false }),
                  cThrow(20, 5, { description: 't → DE', adjust: -2, firstDamage: 7, knockdown: false }),
                  cStrike(20, 8, { description: 'A → BCX', adjust: -3, firstDamage: 3, height: StrikeHeight.Low }),
                  cStrike(10, 11, { description: 'Y', blockDamage: 2, unsafe: true }),
                  cStrike(20, 15, { description: '1', blockDamage: 1, adjust: -2, always: true, unsafe: true, super: true }),
                  cStrike(20, 15, { description: '1', blockDamage: 1, adjust: -2, always: true, unsafe: true, super: true }),
              ], hitback: cStrike(20, 0, { adjust: -2 })
          },
      ],
      knockdown: { choices: [
              BLOCK_HIGH,
              cThrow(7, 5),
              cStrike(10, 11, { blockDamage: 2, unsafe: true }),
              cStrike(10, 11, { blockDamage: 2, unsafe: true }),
              cStrike(10, 11, { blockDamage: 2, unsafe: true }),
              cStrike(10, 11, { blockDamage: 2, unsafe: true }),
              cStrike(10, 11, { blockDamage: 2, unsafe: true }),
              cStrike(10, 11, { blockDamage: 2, unsafe: true }),
          ] },
      desperate: {
          choices: [
              null,
              null,
              null,
              null,
              cStrike(20, 15, { description: '1', blockDamage: 1, adjust: -2, always: true, unsafe: true, super: true }),
              cStrike(20, 15, { description: '1', blockDamage: 1, adjust: -2, always: true, unsafe: true, super: true }),
              cStrike(20, 15, { description: '1', blockDamage: 1, adjust: -2, always: true, unsafe: true, super: true }),
              cStrike(20, 15, { description: '1', blockDamage: 1, adjust: -2, always: true, unsafe: true, super: true }),
          ]
      }
  };

  //-- State --
  let handSize = 9;
  let choiceIndex = 0;
  let mode = '';
  let hitback = false;
  let desperate = false;
  //-- Actions --
  const choiceLeft = () => { choiceIndex = clamp(choiceIndex - 1, 0, 7); };
  const choiceRight = () => { choiceIndex = clamp(choiceIndex + 1, 0, 7); };
  const choiceRandom = () => { choiceIndex = Math.floor(Math.random() * 8); };
  const handsizeDown = () => { handSize = clamp(handSize - 1, 5, 12); };
  const handsizeUp = () => { handSize = clamp(handSize + 1, 5, 12); };
  const toggleKnockdown = () => { mode = mode ? '' : 'knockdown'; };
  const toggleHitback = () => { hitback = !hitback; };
  const toggleDesperate = () => { desperate = !desperate; };
  //-- Utils --
  function style(props) {
      const attributeValue = Object.entries(props)
          .map(([key, value]) => `${key}: ${value}`)
          .join('; ');
      return `style="${attributeValue}"`;
  }
  function when(condition, template) {
      return condition ? template : '';
  }
  function clamp(value, min, max) {
      if (value < min) {
          return min;
      }
      if (value > max) {
          return max;
      }
      return value;
  }
  //-- Rendering --
  function typeColor(type) {
      switch (type) {
          case MoveType.Dodge: return '#080';
          case MoveType.Throw: return '#000';
          case MoveType.Strike:
              return '#f33';
          case MoveType.Projectile:
              return '#f90';
          case MoveType.BlockLow:
          case MoveType.BlockHigh:
              return '#00f';
      }
  }
  function typeClass(type) {
      switch (type) {
          case MoveType.BlockLow:
          case MoveType.BlockHigh:
              return 'block';
          case MoveType.Projectile:
              return 'projectile';
          default: return '';
      }
  }
  function toggleClass(enabled) {
      return enabled ? 'on' : 'off';
  }
  function heightStyle(height) {
      switch (height) {
          case StrikeHeight.Low: return { top: '55%' };
          case StrikeHeight.Mid: return { display: 'none' };
          case StrikeHeight.High: return { top: '25%' };
      }
  }
  function renderMove(choice) {
      const { type, damage, firstDamage, blockDamage, speed, adjust, always, height, level, description, unsafe, knockdown, edge, recur, lockdown, drawOnBlock, } = choice;
      const hasGap = type === MoveType.BlockLow || type === MoveType.BlockHigh;
      const gapPosition = type === MoveType.BlockLow ? '50%' : '0';
      const reversal = speed > 10;
      const speedStyle = reversal ? {
          background: '#333',
          color: 'palegoldenrod',
          'border-color': 'darkgoldenrod',
      } : {
          background: 'palegoldenrod',
          color: 'black',
          'border-color': 'black',
      };
      const levelText = Array(level).fill('I').join('');
      const flags = [];
      if (unsafe) {
          flags.push(`/!\\`);
      }
      if (knockdown) {
          flags.push(`KD`);
      }
      if (edge) {
          flags.push(`(+)`);
      }
      if (recur) {
          flags.push(`RECUR`);
      }
      if (lockdown) {
          flags.push(`LOCK`);
      }
      if (drawOnBlock) {
          flags.push(`DRAW`);
      }
      return `
        <div class="damage ${typeClass(type)}" style="background: ${typeColor(type)}">
            ${!damage ? '' : damage}
            ${!firstDamage ? '' : `(${firstDamage})`}
            ${!hasGap ? '' : `
                <div class="blockGap" ${style({ top: gapPosition })}></div>
            `}
        </div>
        <div class="description"> ${description} </div>
        <div class="flags"> ${flags.join('<br> ')} </div>
        <div class="height" ${style(heightStyle(height))}></div>

        ${when(level, `<div class="level"> ${levelText} </div>`)}
        ${when(speed, `<div class="speed" ${style(speedStyle)}> ${speed} </div>`)}
        ${when(blockDamage, `<div class="blockDamage"> ${blockDamage} </div>`)}
        ${when(adjust, `<div class="adjust"> ${adjust}${always ? '!' : ''} </div>`)}
    `;
  }
  function getChoiceRow(bot) {
      // Default choice
      const rowIndex = Math.floor((handSize - 5) / 2);
      let row = bot.normal[rowIndex];
      // Mode-specific overrides
      if (desperate) {
          row = applyOverride(row, bot.desperate);
      }
      if (mode === 'knockdown') {
          row = applyOverride(row, bot.knockdown);
      }
      return row;
  }
  function getChoice(bot) {
      const row = getChoiceRow(bot);
      if (hitback) {
          return row.hitback;
      }
      return row.choices[choiceIndex];
  }
  function renderContent() {
      const choice = getChoice(bot1);
      const modeStr = !mode ? '' : `(${mode.toUpperCase()})`;
      const isKnockdown = mode == 'knockdown';
      const choiceText = hitback ? '*' : choiceIndex + 1;
      return `
        <div class="header"> [${handSize}] / ${choiceText} ${modeStr}</div>
        <div class="move"> ${renderMove(choice)} </div>
        <div class="toggles">
            <button data-action="desperate" class="${toggleClass(desperate)}"> Desperation </button>
            <button data-action="knockdown" class="${toggleClass(isKnockdown)}"> Knockdown </button>
            <button data-action="hitback" class="${toggleClass(hitback)}"> Hitback </button>
        </div>
        <div class="controls">
            <button data-action="left"> &lt; </button>
            <button data-action="right"> &gt; </button>
            
            <button class="large" data-action="roll"> ROLL </button>
            
            <button data-action="down"> - </button>
            <button data-action="up"> + </button>
        </div>
    `;
  }
  function main() {
      const html = document.documentElement;
      const container = document.querySelector('#main');
      const KEY_HANDLERS = {
          "ArrowLeft": choiceLeft,
          "ArrowRight": choiceRight,
          "ArrowUp": handsizeDown,
          "ArrowDown": handsizeUp,
          "r": choiceRandom,
          "k": toggleKnockdown,
          "h": toggleHitback,
          "d": toggleDesperate,
      };
      document.addEventListener('keydown', (e) => {
          const handler = KEY_HANDLERS[e.key];
          if (handler) {
              handler();
              render();
          }
      });
      const ACTION_HANDLERS = {
          roll: choiceRandom,
          left: choiceLeft,
          right: choiceRight,
          up: handsizeUp,
          down: handsizeDown,
          // Toggles
          knockdown: toggleKnockdown,
          hitback: toggleHitback,
          desperate: toggleDesperate,
      };
      html.addEventListener('click', e => {
          const target = e.target;
          if (target instanceof HTMLButtonElement) {
              const handler = ACTION_HANDLERS['' + target.dataset.action];
              if (handler) {
                  handler();
                  render();
              }
          }
      });
      function render() {
          container.innerHTML = renderContent();
      }
      render();
  }
  document.addEventListener('DOMContentLoaded', main);

})();

        </script>
    
</body>
</html>